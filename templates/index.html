<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Environment Issues</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body class="bg-light">
    <div class="container my-5">
        <h1 class="text-center mb-4">Local Environment Issues</h1>
        <div class="text-end mb-3">
            <a href="/add" class="btn btn-primary">Report a New Issue</a>
        </div>
        {% for complaint in complaints %}
        <div class="card mb-3">
            <div class="card-body">
                <h5>{{ complaint.title }}</h5>
                <p>{{ complaint.description }}</p>
                <small class="text-muted">Reported by: {{ complaint.reporter_name }}</small><br>
                <span class="badge {% if complaint.is_solved %}bg-success{% else %}bg-danger{% endif %}">
                    {% if complaint.is_solved %}Solved{% else %}Unsolved{% endif %}
                </span>
                {% if complaint.latitude and complaint.longitude %}
                <div id="map-{{ complaint.id }}" style="height: 300px;" class="mt-3"></div>
                <script>
                    var map{{ complaint.id }} = L.map('map-{{ complaint.id }}').setView([{{ complaint.latitude }}, {{ complaint.longitude }}], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: 'Â© OpenStreetMap contributors'
                    }).addTo(map{{ complaint.id }});
                    L.marker([{{ complaint.latitude }}, {{ complaint.longitude }}]).addTo(map{{ complaint.id }});
                </script>
                {% endif %}
                {% if not complaint.is_solved %}
                    <a href="/solve/{{ complaint.id }}" class="btn btn-sm btn-outline-success float-end">Mark as Solved</a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</body>
</html>
